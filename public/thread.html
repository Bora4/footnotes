<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="document-title">Thread</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script>
        fetch('/users/get-auth').then(response => response.json()).then(data => {
            if (data.isAuthenticated) {
                login = document.getElementById('login');
                login.textContent = data.username;
                login.href = '/users/' + data.userId;
            } else {
                login.textContent = 'Login';
            }
        }).catch(error => {
            console.error('Error fetching session data: ', error);
        });
    </script>
</head>

<body>
    <header>
        <div class="row head-row">
            <ul>
                <li>
                    <a href="./index.html"> Home </a>
                </li>
                <li>
                    <a href="./threads.html"> Threads </a>
                </li>
                <li>
                    <a href="./login.html" id="login"> Login </a>
                </li>
            </ul>
        </div>
    </header>
    <div class="col main-col">

        <h1 id="thread-title"></h1>
        <ul id="messages-list"></ul>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const threadId = urlParams.get('id');

        if (threadId) {
            fetch(`/threads/${threadId}`)
                .then(response => response.json())
                .then(thread => {
                    if (thread) {
                        document.getElementById('document-title').textContent = thread.title
                        document.getElementById('thread-title').textContent = thread.title;
                        const messagesList = document.getElementById('messages-list');
                        thread.messages.forEach(message => {
                            console.log(message);
                            const li = document.createElement('li');
                            li.textContent = message.body;
                            messagesList.appendChild(li);
                        });
                    } else {
                        document.getElementById('thread-title').textContent = 'Thread not found';
                    }
                })
                .catch(error => console.error('Error fetching thread:', error));
        } else {
            document.getElementById('thread-title').textContent = 'No thread ID provided';
        }
    </script>
</body>

</html>